<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Our Impact - Dooradrusthi Foundation</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
<link href="site.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

<style>
/* Scroll Wrapper Fix */
.scroll-wrapper {
  position: relative;
  overflow: hidden; /* Prevents arrows from moving */
  width: 100%;
  padding: 0 50px; /* Space for arrows */
}

/* Arrow Buttons */
.scroll-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 20;
  background: rgba(0,0,0,0.55);
  color: white;
  border: none;
  font-size: 32px;
  width: 45px;
  height: 45px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* Left/Right Position */
.left-btn { left: 5px; }
.right-btn { right: 5px; }

/* Button Hover */
.scroll-btn:hover {
  background: rgba(0,0,0,0.8);
}

/* Mobile Optimized */
@media (max-width: 768px) {
  .scroll-btn {
    font-size: 22px;
    width: 35px;
    height: 35px;
  }
  .scroll-wrapper {
    padding: 0 40px;
  }
}
</style>
</head>

<body>

<!-- Navbar placeholder -->
<div id="navbar"></div>

<!-- Impact Section -->
<div class="container impact-section">
  <h2>Our Contributions</h2>
  <hr>
  <div class="d-flex justify-content-around flex-wrap mt-4">
    <div>
      <div style="color: orange;" class="impact-value" id="donationCounter">₹0</div>
      <div class="impact-label">Total Donations</div>
    </div>
    <div>
      <div style="color: blue;" class="impact-value" id="peopleHelpedCounter">0</div>
      <div class="impact-label">People Helped</div>
    </div>
    <div>
      <div class="impact-value" id="pendingAmountCounter">₹0</div>
      <div class="impact-label">Pending Amount</div>
    </div>
  </div>
</div>

<!-- Donation Section -->
<div class="donation-section">
  <h2>Support Our Cause</h2>
  <p>Your donations help us reach more people. Scan the QR below or click the Donate button to contribute.</p>
  <div class="donation-qr">
    <img src="Images/DOOR QR.jpeg" alt="Donate QR Code">
  </div>
  <a href="Donate.html" class="btn btn-primary btn-lg">Donate Now</a>
</div>

<!-- Press Coverage -->
<h2 class="section-title">Press Coverage</h2>
<hr>

<div class="scroll-wrapper">
  <button class="scroll-btn left-btn" data-target="pressContainer">&#10094;</button>
  <div class="scroll-container" id="pressContainer"></div>
  <button class="scroll-btn right-btn" data-target="pressContainer">&#10095;</button>
</div>

<!-- Recent Articles -->
<h2 class="section-title">Recent Articles</h2>
<hr>

<div class="scroll-wrapper">
  <button class="scroll-btn left-btn" data-target="articlesContainer">&#10094;</button>
  <div class="scroll-container" id="articlesContainer"></div>
  <button class="scroll-btn right-btn" data-target="articlesContainer">&#10095;</button>
</div>

<!-- Footer -->
<footer>
  <p>&copy; 2025 - Dooradrusthi Foundation. All rights reserved.</p>
</footer>

<!-- Scripts -->
<script src="Scripts/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

<!-- Load navbar dynamically -->
<script>
fetch("navbar.html")
  .then(res => res.text())
  .then(data => {
    document.getElementById("navbar").innerHTML = data;
    const currentPage = window.location.pathname.split("/").pop();
    document.querySelectorAll(".navbar-nav .nav-link").forEach(link => {
      if (link.getAttribute("href") === currentPage) link.classList.add("active");
    });
  })
  .catch(err => console.error("Navbar load failed:", err));
</script>

<!-- Load JSON dynamic content -->
<script>
async function loadData() {
  try {
    const response = await fetch('info.json');
    const data = await response.json();
    const startTime = new Date(2025, 9, 10, 15, 0, 0);
    const currentTime = new Date();
    const diffInSeconds = Math.floor((currentTime - startTime) / 1000);
    const value = diffInSeconds >= 0 ? Math.floor(diffInSeconds / 3) : 0;

    animateCounters(
      (data.TotalDonations || 0) + value,
      data.PeopleHelped,
      (data.PendingAmount || 0) + value,
      data.CountSpeed || 50
    );

    const press = document.getElementById("pressContainer");
    if (data.Press) {
      press.innerHTML = [...data.Press, ...data.Press].map(p => `
        <div class="press-card">
          <a href="${p.Url}" target="_blank">
            <img src="${p.Image}" alt="${p.Description}">
            <h5>${p.Description}</h5>
          </a>
        </div>
      `).join('');
    }

    const articles = document.getElementById("articlesContainer");
    if (data.Articles) {
      articles.innerHTML = [...data.Articles, ...data.Articles].map(a => `
        <div class="article-card">
          <a href="Article.html?id=${a.No}">
            <img src="${a.ImageUrl}" alt="${a.Title}">
            <div class="card-body">
              <h5>${a.Title}</h5>
              <p style="color:#6c757d">${a.Date}</p>
              <p>${a.Description}</p>
              <small>Posted by ${a.PostedBy}</small>
            </div>
          </a>
        </div>
      `).join('');
    }
  } catch (err) {
    console.error("Error loading info.json:", err);
  }
}

function animateCounters(finalAmount, finalDonations, finalPending, speed) {
  const donationCounter = document.getElementById("donationCounter");
  const peopleCounter = document.getElementById("peopleHelpedCounter");
  const pendingCounter = document.getElementById("pendingAmountCounter");

  let d = 0, p = 0, pn = 0;
  const dSpeed = Math.max(1, Math.ceil(finalAmount / speed));
  const pSpeed = Math.max(1, Math.ceil(finalDonations / speed));
  const pnSpeed = Math.max(1, Math.ceil(finalPending / speed));

  function curr(n) { return "₹" + n.toLocaleString("en-IN"); }

  function step() {
    let run = false;
    if (d < finalAmount) { d += dSpeed; if (d>finalAmount) d=finalAmount; donationCounter.textContent = curr(d); run = true; }
    if (p < finalDonations) { p += pSpeed; if (p>finalDonations) p=finalDonations; peopleCounter.textContent = p.toLocaleString("en-IN"); run = true; }
    if (pn < finalPending) { pn += pnSpeed; if (pn>finalPending) pn=finalPending; pendingCounter.textContent = curr(pn); run = true; }
    if (run) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

loadData();
</script>

<!-- Arrow & Swipe JS -->
<script>
// Arrow Scroll
document.querySelectorAll(".scroll-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const container = document.getElementById(btn.dataset.target);
    container.scrollBy({
      left: btn.classList.contains("left-btn") ? -350 : 350,
      behavior: "smooth"
    });
  });
});

// Mobile Swipe Support
document.querySelectorAll(".scroll-container").forEach(container => {
  let startX = 0, scrollLeft = 0, isDown = false;

  container.addEventListener("touchstart", e => {
    isDown = true;
    startX = e.touches[0].pageX;
    scrollLeft = container.scrollLeft;
  });

  container.addEventListener("touchmove", e => {
    if (!isDown) return;
    const x = e.touches[0].pageX;
    container.scrollLeft = scrollLeft - (x - startX) * 1.4;
  });

  container.addEventListener("touchend", () => isDown = false);
});
</script>

</body>
</html>
